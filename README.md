<h1 align="center">Welcome to AgileWork ğŸ‘‹</h1>

## ç³»åˆ—æ–‡ç« 
[ã€æ–‡ç« ç›®å½•ã€‘](https://www.cnblogs.com/zypblog/p/13546760.html)

## ä»‹ç»
æ•æ·åº”ç”¨æ„å»ºå¹³å°é¢„æœŸå°†å½¢æˆä¸€æ¬¾å¯è§†åŒ–ä½ä»£ç å¿«é€Ÿå¼€å‘å¹³å°ï¼Œé¢å‘ä¸šåŠ¡ã€ä¼ä¸šç®¡ç†ç³»ç»Ÿå®šåˆ¶å¼€å‘å¹³å°å’Œåº”ç”¨å¹³å°ï¼ŒåŒ…æ‹¬è®¾è®¡å™¨ã€åº”ç”¨ç«¯ã€‚æä¾›ä¸šåŠ¡é…ç½®å’Œé›†æˆå¼€å‘èƒ½åŠ›ï¼Œç”¨æˆ·é€šè¿‡å¯è§†åŒ–æ‹–æ‹‰æ‹½é…ç½®å¼æ“ä½œå³å¯å¿«é€Ÿæ„å»ºå‡ºèƒ½åŒæ—¶åœ¨PCå’Œç§»åŠ¨ç«¯è¿è¡Œçš„å„ç±»ç®¡ç†ç³»ç»Ÿï¼Œå¯¹äºä¼ä¸šå®¢æˆ·çš„ä¿¡æ¯ç³»ç»Ÿåœ¨ç®¡ç†æ¨¡å¼ã€ä¸šåŠ¡æµç¨‹ã€è¡¨å•ç•Œé¢ã€æ•°æ®å¯è§†åŒ–å±•ç¤ºã€IoTç®¡æ§ç­‰ä¸ªæ€§åŒ–éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡è®¾è®¡å™¨ï¼Œå¿«é€Ÿçš„è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ã€‚å¹¶æ”¯æŒä¼ä¸šå¾®ä¿¡ï¼Œå…¬ä¼—å·ï¼Œé’‰é’‰ç­‰ç§»åŠ¨é›†æˆï¼Œå®ç°ç”¨æˆ·è·¨åŒºåŸŸç§»åŠ¨åŠå…¬ã€‚ä»è€Œæ„å»ºä¼ä¸šä¸ªæ€§åŒ–çš„è¡Œä¸šåº”ç”¨ã€é›†æˆåº”ç”¨å’Œå¤æ‚çš„ä¸šåŠ¡æŠ¥è¡¨ã€‚

* Ocelotç½‘å…³ï¼Œå¤šä¸ªWebåº”ç”¨ç¨‹åº, æ¯ä¸ªåº”ç”¨éƒ½ä½¿ç”¨ä¸åŒçš„APIç½‘å…³.
* åŒ…å«ä½¿ç”¨IdentityServer4èº«ä»½è®¤è¯æœåŠ¡ï¼ŒSSO(å•ç‚¹ç™»é™†)åº”ç”¨ç¨‹åº.
* é‡‡ç”¨ä¸åŒç±»å‹çš„æ•°æ®åº“: SQL Serverã€MySqlã€MongoDB.
* ä½¿ç”¨ Redis åšåˆ†å¸ƒå¼ç¼“å­˜.
* ä½¿ç”¨ RabbitMQ åšæœåŠ¡é—´çš„æ¶ˆæ¯ä¼ é€’.
* ä½¿ç”¨ Docker æ¥éƒ¨ç½²&è¿è¡Œæ‰€æœ‰çš„æœåŠ¡å’Œåº”ç”¨ç¨‹åº.
* ä½¿ç”¨ Elasticsearch & Logstash & Kibana æ¥å­˜å‚¨å’Œå¯è§†åŒ–æ—¥å¿—

## ç›¸å…³æŠ€æœ¯
åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„åˆ†å±‚æ¨¡å‹ï¼Œåº•å±‚æ¡†æ¶é‡‡ç”¨ ABP vNext å¾®æœåŠ¡æ­å»ºé¡¹ç›®ï¼Œæ”¯æŒå„ç§ä¸»æµæ•°æ®åº“(SqlServerã€MySQLã€PostgreSqlã€Sqlite)æ¥å…¥ï¼Œæ¥å£éµå¾ª RESTful API æ¥å£è§„èŒƒã€‚å‰ç«¯é‡‡ç”¨Reactï¼Œé€šè¿‡å°è£…åçš„axiosè¿›è¡Œæ•°æ®è¯·æ±‚ã€‚å®é™…å¼€å‘ä¸­å¯èƒ½æ¶‰åŠåˆ°å…¶ä»–æ’ä»¶å’Œç»„ä»¶ã€‚
* ABP vNext
* ABP Framework
* .NET Core 3.1
* Docker
* Kubernates
* Kibana
* Elasticsearch
* Nginx
* Redis
* Hangfire
* RabbitMQ
* MySQL
* SqlServer
* MongoDB
* WebApi
* IdentityServer
* EntityFramework Core
* Swagger
* log4net
* MailKit
* axios
* Json
...

## é¡¹ç›®ç»“æ„
* `_run`
  * `__Open_Browser.ps1` - **æ‰“å¼€æµè§ˆå™¨**
  * `__Run_All_Service.ps1` - **è¿è¡Œå…¨éƒ¨é¡¹ç›®**
  * `__Run_Docker_Service.ps1` - **è¿è¡Œé¡¹ç›®åˆ° Docker**
  * `__Run_Infrastructure.ps1` - **è¿è¡Œ Docker åŸºç¡€è®¾æ–½**
  * `__Stop_Docker_Service.ps1` - **åœæ­¢ Docker é¡¹ç›®**
  * `__Stop_Infrastructure.ps1` - **åœæ­¢ Docker åŸºç¡€è®¾æ–½**
  * `01_AuthServer.ps1` - **è¿è¡ŒæˆæƒæœåŠ¡**
  * `02_BackendAdminService.ps1` - **è¿è¡Œåå°ç®¡ç†æœåŠ¡**
  * `03_InternalGateway.ps1` - **è¿è¡Œå†…éƒ¨ç½‘å…³**
  * `04_BackendAdminGateway.ps1` -**è¿è¡Œåå°ç®¡ç†ç½‘å…³**
* `data` - **æ•°æ®åº“æ–‡ä»¶**
* `docs` - **æ–‡æ¡£æ–‡ä»¶**
  * `images`
  * `releases`
* `elk` - **ELK æ—¥å¿—é…ç½®**
* `logs` - **Docker é¡¹ç›®è¿è¡Œæ—¥å¿—**
* `service` - **åå°æœåŠ¡**
  * `auth` - **æˆæƒ**
    * AuthServer.Host - **æˆæƒæœåŠ¡**
  * `framework` - **æ¡†æ¶**
  * `gateways` - **ç½‘å…³**
    * BackendAdminGateway.Host -**åå°ç®¡ç†ç½‘å…³**
    * InternalGateway.Host - **å†…éƒ¨ç½‘å…³**
  * `microservices` - **æœåŠ¡**
    * BackendAdminService.Host - **åå°ç®¡ç†æœåŠ¡**
  * `modules` - **æ¨¡å—**
    * account - **è´¦æˆ·**
    * audit-logging - **æ—¥å¿—**
    * backend-admin - **åå°**
    * feature-management - **åŠŸèƒ½**
    * file-management - **æ–‡ä»¶**
    * identity - **èº«ä»½è®¤è¯**
    * identityServer - **è®¤è¯æœåŠ¡**
    * permissions-management - **æƒé™**
    * setting-management - **è®¾ç½®**
    * tenant-management - **ç§Ÿæˆ·**
  * `shared` - **å…±æœ‰**
  * `common.props`
  * `Microservice.sln`
* `.dockerignore`
* `.gitignore`
* `docker-compose.infrastructure.override.yml` - **Docker åŸºç¡€è®¾æ–½ï¼ˆç¯å¢ƒå˜é‡ã€å‚æ•°ï¼‰**
* `docker-compose.infrastructure.yml` - **Docker åŸºç¡€è®¾æ–½**
* `docker-compose.override.yml` - **Docker é¡¹ç›®è¿è¡Œï¼ˆç¯å¢ƒå˜é‡ã€å‚æ•°ï¼‰**
* `docker-compose.yml` - **Docker é¡¹ç›®è¿è¡Œ**
* `README.md`

## åˆ†å±‚ç»“æ„
![agilework.jpg](https://github.com/zhang8043/AgileWork/blob/master/docs/images/agilework.jpg)

## è‡ªåŠ¨åŒ–æ„å»ºCI/CD
![cicd.png](https://github.com/zhang8043/AgileWork/blob/master/docs/images/cicd.png)

## ç¯å¢ƒå‡†å¤‡

* Docker Desktop
* SQL Server 2015+
* MySQL 5.7
* Redis 5.0+
* RabbitMQ 3.7.11+
* MongoDB 4.0+
* ElasticSearch 6.6+
* Logstash 6.6+
* Kibana 6.6+

## è¿è¡Œè§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ç¯å¢ƒé…ç½®

æ•°æ®åº“è¿æ¥ã€Redisã€RabbitMQã€ElasticSearchã€AuthServerã€IdentityServer

* `service/auth/AuthServer.Host/appsettings.json`
* `service/gateways/BackendAdminGateway.Host/appsettings.json`
* `service/gateways/InternalGateway.Host/appsettings.json`
* `service/microservices/BackendAdminService.Host/appsettings.json`

### æ‰“å¼€å¹¶æ„å»ºVisual Studioè§£å†³æ–¹æ¡ˆ

* åœ¨Visual Studioä¸­æ‰“å¼€ `service/Microservice.sln` å¹¶æ„å»ºè§£å†³æ–¹æ¡ˆ.
* åœ¨ `service` æ–‡ä»¶å¤¹ä¸­è¿è¡Œ `dotnet restore` å‘½ä»¤.

### åˆ›å»ºæ•°æ®åº“

**AuthServer æ•°æ®åº“**

* å³é”® `AuthServer.Host` é¡¹ç›®,ç„¶åç‚¹å‡» `è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®`.
* æ‰“å¼€ **ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°** (å·¥å…· -> NuGet åŒ…ç®¡ç†å™¨ -> ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°)
* é€‰æ‹© `AuthServer.Host` æˆä¸º é»˜è®¤é¡¹ç›®.
* æ‰§è¡Œ `Update-Database` å‘½ä»¤.

**BackendAdminService æ•°æ®åº“**

* å³é”® `BackendAdminService.Host` é¡¹ç›®,ç„¶åç‚¹å‡» `è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®`.
* æ‰“å¼€ **ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°** (å·¥å…· -> NuGet åŒ…ç®¡ç†å™¨ -> ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°)
* é€‰æ‹© `BackendAdminService.Host` æˆä¸º é»˜è®¤é¡¹ç›®.
* æ‰§è¡Œ `Update-Database` å‘½ä»¤.

### 1ã€Docker è¿è¡Œ

åœ¨ `é¡¹ç›®æ ¹ç›®å½•` ä¸‹è¿è¡Œ `docker-compose` å‘½ä»¤æˆ–ä½¿ç”¨ `PowerShell` è¿è¡Œ `_run` æ–‡ä»¶å¤¹ä¸‹çš„è„šæœ¬

**è¿è¡ŒåŸºç¡€è®¾æ–½**

ä½¿ç”¨ `PowerShell` è¿è¡Œ `_run` æ–‡ä»¶å¤¹ä¸‹çš„ `__Run_Infrastructure.ps1` è„šæœ¬æˆ–ï¼š
```PowerShell
docker-compose -f docker-compose.infrastructure.yml -f docker-compose.infrastructure.override.yml up -d
```

**è¿è¡Œé¡¹ç›®**

ä½¿ç”¨ `PowerShell` è¿è¡Œ `_run` æ–‡ä»¶å¤¹ä¸‹çš„ `__Run_Docker_Service.ps1` è„šæœ¬æˆ–ï¼š
```PowerShell
docker-compose -f docker-compose.yml -f docker-compose.override.yml up -d
```

### 2ã€Visual Studio è¿è¡Œ

æŒ‰ä»¥ä¸‹é¡ºåºè¿è¡Œé¡¹ç›®(å³é”®å•å‡»æ¯ä¸ªé¡¹ç›®è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®,æŒ‰Ctrl+F5è¿è¡Œ,æ— éœ€è°ƒè¯•):

* AuthServer.Host
* BackendAdminApp.Host
* InternalGateway.Host
* BackendAdminAppGateway.Host

## æ‰€éœ€åŸºç¡€
æœåŠ¡ç«¯é‡‡ç”¨çš„æ˜¯.NET Abp vNextå¾®æœåŠ¡æ¶æ„ï¼Œéœ€è¦äº†è§£å¾®æœåŠ¡æ¶æ„å’Œç†Ÿæ‚‰ C#ã€‚

æ­¤ç³»åˆ—æ–‡ç« ä¼šè¿›è¡Œä¸å®šæœŸçš„æ›´æ–°ï¼Œä½“é‡å¾ˆå¤§ï¼Œå®ç°åŠŸèƒ½æ¯”è¾ƒå¤æ‚ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è·Ÿç€çœ‹çœ‹ï¼Œæœ¬ç³»ç»Ÿæ˜¯é‡‡ç”¨ABP vNextå¾®æœåŠ¡å¼€å‘çš„æ•æ·åº”ç”¨æ„å»ºå¹³å°ï¼Œé€‚åˆå·²ç»çœ‹è¿‡ ABP vNext çš„æ–‡æ¡£åŠäº†è§£å¾®æœåŠ¡æ¶æ„çš„å°ä¼™ä¼´ä»¬ã€‚